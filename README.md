# ppu_client-server
 Клиент-серверное приложение для работы с термопринтерами на ESC/POS командах
 
 Данное приложение, как уже понятно из описания, позволяет печатать текст на термопринтере, работающем на ESC/POS командах (конкретно у меня это Citizen PPU-700), в пределах локальной сети. Серверная часть (подключаемая к принтеру) написана на Python, ровно как и клиентская, а потому **данный софт можно считать кросс-платформенным.**
 
 # Состав проекта
 1. `__server__.py` - серверная часть проекта, устанавливаемая на машину (любой операционной системы, хотя тестировалось только из-под Windows 10). Занимает COM-порт для управления принтером и сетевой порт для приёма подключений от клиентов, переводит принятый от клиента текст на русском языке в адреса символов кастомного шрифта, форматирует заголовки. **Вам понадобится лишь подправить адрес COM-порта, куда подключен принтер, и скорость передачи данных на нём (а может и нет).**
 2. `__client__.py` - клиентская часть, запускаемая откуда угодно, лишь бы там доступ к интернету (локальной сети) был. Собирает немного данных от пользователя (заголовок, тело, конец), подключается к серверу и передаёт ему собранную информацию. **Не забудьте поменять IP адрес сервера в 4-й строке скрипта!**
 3. `example/` - Пример работы программы: что ввёл в клиент, что отобразилось на сервере и что напечаталось на ленте (_кажется, мой печатник успел забиться пылью после такого простоя_).
 4. Шпаргалка по ESC/POS командам на случай, если вам станет интересна эта тема и вы захотите улучшить мой проект или разработать свой.
 5. `POS_utility/POS_Printer_Utility_v283E.zip` - Фирменная программа от Citizen для загрузки шрифтов и настройки принтера в принципе. Она понадобится для добавления в принтер русских символов (в той же папке лежит 2 скриншота, куда и в какой последовательности нажимать). Настройка принтера в этот проект не входит, увы.
 6. `POS_utility/ppu-700_RUS_v2.cgh` - Шрифт с русским языком для термопринтеров Citizen.
 
 # Требования (библиотеки)
 - pyserial #server only
 - datetime #server only
 - sockets #насколько я помню, она доступна "из коробки"

p.s. Разработано и протестировано на версии Python 3.10.11. К сожалению, за более старые/новые версии ничего сказать не могу.

 # Совместимость
 Данный проект совместим с любыми операционными системами с поддержкой интерпретируемого языка Python, COM-портов, а также с ЛЮБЫМИ кассовыми термопринтерами, работающими на ESC/POS командах - а это все старые Epson'ы и Citizen'ы (CBM1000, CBM2000, PPU-700). На принтерах Custom проект не проверялся, но скорее всего тоже работает _(просто дайте гарантию, что там тоже есть ESC/POS команды)_.
 ***ВАЖНОЕ ЗАМЕЧАНИЕ: для корректной работы данной программы необходимо сначала удалить фирменный драйвер на PPU-700 (если, конечно, у вас вообще PPU-700 и вы устанавливали для него официальный драйвер)!!!***
 
 # Принцип работы
 Опять же, если у вас нет желания и/или возможности разбираться в моих скриптовых костылях, я объясню принцип работы:
 1. Сервер открывает сокет по IP-адресу серверной машины (к которой подключен термопринтер) и установленному в переменной порту.
 2. Клиент в пределах локальной сети подключается на указанный в его настройках IP адрес и порт, после чего устанавливается соединение с сервером.
 3. Со стороны клиента (в зависимости от его версии) собирается такая информация, как заголовок, тело и конец документа (чека), после чего всё это поочерёдно отправляется на сервер с предварительной передачей длины сообщения (TCP вам не UDP).
 4. Сервер принимает пакеты указанной длины, прогоняет всё через переводчик: у принтера "из коробки" есть только английский алфавит, русский же нужно загрузить вручную; перевод заключается в конвертации букв русского алфавита в адреса (биты) символов из заранее загруженного шрифта. В самом скрипте сервера есть подробные комментарии на этот счёт...
 5. Происходит отправка данных на принтер через COM-порт, даётся команда на печать и отрезание.
 
 # Дерзайте!
 На этом всё. Как смог, объяснил принцип работы и подготовительные этапы. Код у проекта открытый, можете улучшать его как вздумаете ;)